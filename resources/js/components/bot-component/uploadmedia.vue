<template>
    <div class="media-container" @click.stop="">
        <div class="tab-list">
            <div @click="openMediaTab(0)" :class="[mediaTabId === 0 ?'selected' :'']">Youtube</div>
            <div @click="openMediaTab(1)" :class="[mediaTabId === 1 ?'selected' :'']">Giphy</div>
            <div @click="openMediaTab(2)" :class="[mediaTabId === 2 ?'selected' :'']">Upload file</div>
            <div @click="openMediaTab(3)" :class="[mediaTabId === 3 ?'selected' :'']">From URL</div>
        </div>
        <div style="justify-content: center;display: flex;flex: 1;flex-direction: column;">
            <div v-if="mediaTabId === 0" style="display: flex; flex: 1;flex-direction: column;justify-content: center;">
                <input id="youtube-link" type="text" style="border-radius: 32px;border: 1px solid #c4c4c4;padding: 10px;font-size: 12px;color: #7d7777;">
                <button class="upload-file" @click="pasteYoutubeLink()">
                    Upload
                </button>
            </div>

            <div v-if="mediaTabId === 1" style="display: flex; flex: 1;flex-direction: column;justify-content: center;">
                <input @keyup="gifSearch()" v-model="queryTitle" id="giphy-url-link" placeholder="Paste link" type="text" style="border-radius: 32px;border: 1px solid #c4c4c4;padding: 10px;font-size: 12px;color: #7d7777;">

                <div id="giphy-box" style="display: flex; flex-wrap: wrap;overflow-y: scroll;height: 290px;margin-top: 5px;">
                    <div @click="pasteLink(gif.images.original.url)" v-for="gif in giphyList" style="margin: 5px; cursor: pointer;">
                        <img :src="gif.images.fixed_width_downsampled.url" alt="" style="max-width: 120px;">
                    </div>
                </div>
            </div>

            <div v-if="mediaTabId === 2" style="display: flex; flex: 1;flex-direction: column;justify-content: center;">
                <svg width="138" height="126" viewBox="0 0 138 126" fill="none" xmlns="http://www.w3.org/2000/svg"
                     style="align-self: center;">
                    <path
                        d="M74.5092 74.3733H82.6875C85.912 74.1376 88.9157 72.6575 91.1474 70.2041C93.372 67.7672 94.5966 64.6232 94.5966 61.3512C94.5919 58.5003 93.6227 55.6635 91.8681 53.3664C90.1222 51.0803 87.6824 49.4329 84.9988 48.729L84.7528 48.6646L84.7102 48.4148C84.1527 45.1161 82.5416 42.1724 80.0505 39.9021C77.2905 37.3858 73.7096 36 69.9662 36C67.0729 36 64.2687 36.8225 61.8572 38.3788C59.855 39.6664 58.1777 41.4253 57.0067 43.4647L56.8679 43.7067L56.5927 43.6556C56.0746 43.559 55.5565 43.5103 55.0526 43.5103C50.6381 43.5103 47.047 47.0879 47.047 51.4857C47.047 52.0207 47.1014 52.5643 47.2141 53.148L47.2615 53.3931L47.058 53.54C44.145 55.6501 42.4054 59.0416 42.4054 62.6097C42.4054 65.5188 43.496 68.3517 45.4769 70.5875C47.5106 72.8759 50.195 74.224 53.0362 74.3835H62.4818C63.0858 74.3835 63.5582 73.9129 63.5582 73.3111C63.5582 72.7094 63.0851 72.2388 62.4818 72.2388H53.1442L53.1324 72.238C50.8716 72.1005 48.7258 71.0086 47.0888 69.1632C45.4572 67.3249 44.559 64.9932 44.559 62.5987C44.559 59.3911 46.2907 56.3917 49.0791 54.7711C49.5294 54.511 49.7266 53.9611 49.5491 53.4615C49.3181 52.8385 49.1998 52.1644 49.1998 51.4629C49.1998 48.2482 51.825 45.633 55.0526 45.633C55.7489 45.633 56.4224 45.7508 57.0524 45.9826C57.5792 46.1735 58.1596 45.9378 58.4009 45.4334C60.5009 40.9933 65.0455 38.1227 69.978 38.1227C76.6092 38.1227 82.0843 43.0719 82.7143 49.6348C82.7617 50.1156 83.1291 50.5076 83.607 50.587C88.646 51.444 92.4446 56.0712 92.4446 61.3504C92.4446 66.9305 88.0152 71.8091 82.57 72.2262L82.5401 72.227H74.5092C73.9051 72.227 73.4328 72.6984 73.4328 73.2994C73.4328 73.9003 73.9059 74.3733 74.5092 74.3733Z"
                        fill="#23282B" fill-opacity="0.6"/>
                    <path
                        d="M68.5065 89.9999C69.1106 89.9999 69.5829 89.5286 69.5829 88.9276V57.7869L75.5399 63.7213C75.7402 63.9248 76.0051 64.0363 76.2874 64.0379H76.2922C76.5776 64.0379 76.8473 63.9256 77.0523 63.7213C77.2574 63.5171 77.3701 63.2476 77.3701 62.9624C77.3701 62.6773 77.2574 62.4078 77.0523 62.2043L69.2628 54.4442C69.0625 54.2447 68.7794 54.1252 68.5065 54.1252C68.2219 54.1252 67.9482 54.2392 67.7558 54.4387L67.7503 54.4442L59.9607 62.2043C59.7557 62.4086 59.6429 62.678 59.6429 62.9632C59.6429 63.2484 59.7557 63.5178 59.9607 63.7221C60.1642 63.9248 60.4394 64.041 60.7162 64.041C61.0008 64.041 61.2745 63.9264 61.4677 63.7276L67.4301 57.7877V88.9284C67.4301 89.5286 67.9025 89.9999 68.5065 89.9999Z"
                        fill="#23282B" fill-opacity="0.6"/>
                    <path
                        d="M107.368 100.971C115.645 100.348 123.359 96.5212 129.094 90.1897C134.838 83.8725 138 75.7267 138 67.2502C137.987 59.8649 135.485 52.5158 130.953 46.5594C126.45 40.6405 120.166 36.3789 113.259 34.5601L111.536 34.1069L111.241 32.3496C109.795 23.7536 105.612 16.0835 99.1449 10.1676C91.982 3.61069 82.6862 0 72.9704 0C65.4603 0 58.1816 2.14281 51.9221 6.19769C46.7222 9.55509 42.3693 14.1361 39.3309 19.4484L38.3569 21.1508L36.4292 20.7908C35.1283 20.5472 33.8289 20.424 32.5678 20.424C21.542 20.424 12.5717 29.3943 12.5717 40.4203C12.5717 41.7672 12.71 43.1411 12.9948 44.6225L13.3255 46.3436L11.9081 47.3748C4.45135 52.7976 0 61.5079 0 70.6737C0 78.1724 2.80473 85.4795 7.89789 91.2502C13.0933 97.1195 19.9315 100.581 27.1552 101H52.6939C53.3929 101 53.9197 100.474 53.9197 99.7756C53.9197 99.0767 53.3929 98.5498 52.6939 98.5498H27.3461L27.2605 98.5445C20.689 98.1432 14.4611 94.9714 9.72713 89.6155C5.03529 84.3077 2.45076 77.5696 2.45076 70.6444C2.45076 61.323 7.46425 52.6067 15.5342 47.8965C16.0513 47.5973 16.273 46.957 16.0686 46.37C15.3742 44.4872 15.0224 42.4661 15.0224 40.3617C15.0224 30.6871 22.8933 22.8163 32.5678 22.8163C34.6533 22.8163 36.6704 23.1703 38.5636 23.8693C39.1685 24.0895 39.8336 23.8182 40.111 23.2372C46.0797 10.5735 58.988 2.39159 72.9989 2.39159C91.8384 2.39159 107.394 16.5089 109.183 35.229C109.236 35.7739 109.654 36.2211 110.196 36.312C124.653 38.7803 135.55 52.0806 135.55 67.2502C135.55 71.175 134.801 75.0412 133.324 78.7406C131.9 82.3077 129.863 85.5704 127.269 88.4378C124.673 91.3081 121.649 93.6388 118.282 95.3652C114.784 97.1586 111.068 98.2176 107.237 98.5114L107.026 98.5197H85.2768C84.5778 98.5197 84.051 99.0466 84.051 99.7456C84.051 100.445 84.5778 100.971 85.2768 100.971H107.368Z"
                        fill="black" fill-opacity="0.1"/>
                    <path
                        d="M40.4209 115.891V120.725C40.4176 121.395 40.2061 121.944 39.7861 122.37C39.3695 122.797 38.8031 123.036 38.0869 123.088L37.8379 123.098C37.0599 123.098 36.4398 122.888 35.9775 122.468C35.5153 122.048 35.2809 121.47 35.2744 120.734V115.891H36.2021V120.705C36.2021 121.219 36.3438 121.62 36.627 121.906C36.9102 122.189 37.3138 122.331 37.8379 122.331C38.3685 122.331 38.7738 122.189 39.0537 121.906C39.3369 121.623 39.4785 121.224 39.4785 120.71V115.891H40.4209ZM46.2217 120.417C46.2217 121.221 46.0378 121.869 45.6699 122.36C45.3021 122.852 44.804 123.098 44.1758 123.098C43.5345 123.098 43.0299 122.894 42.6621 122.487V125.031H41.7588V117.717H42.584L42.6279 118.303C42.9958 117.847 43.5068 117.619 44.1611 117.619C44.7959 117.619 45.2972 117.858 45.665 118.337C46.0361 118.815 46.2217 119.481 46.2217 120.334V120.417ZM45.3184 120.314C45.3184 119.719 45.1914 119.248 44.9375 118.903C44.6836 118.558 44.3353 118.386 43.8926 118.386C43.3457 118.386 42.9355 118.628 42.6621 119.113V121.638C42.9323 122.119 43.3457 122.36 43.9023 122.36C44.3353 122.36 44.6787 122.189 44.9326 121.848C45.1898 121.503 45.3184 120.992 45.3184 120.314ZM48.3555 123H47.4521V115.5H48.3555V123ZM49.5664 120.31C49.5664 119.792 49.6673 119.326 49.8691 118.913C50.0742 118.5 50.3574 118.181 50.7188 117.956C51.0833 117.731 51.4984 117.619 51.9639 117.619C52.6833 117.619 53.2643 117.868 53.707 118.366C54.153 118.864 54.376 119.527 54.376 120.354V120.417C54.376 120.931 54.2767 121.394 54.0781 121.804C53.8828 122.211 53.6012 122.528 53.2334 122.756C52.8688 122.984 52.4489 123.098 51.9736 123.098C51.2575 123.098 50.6764 122.849 50.2305 122.351C49.7878 121.853 49.5664 121.193 49.5664 120.373V120.31ZM50.4746 120.417C50.4746 121.003 50.6097 121.473 50.8799 121.828C51.1533 122.183 51.5179 122.36 51.9736 122.36C52.4326 122.36 52.7972 122.181 53.0674 121.823C53.3376 121.462 53.4727 120.957 53.4727 120.31C53.4727 119.73 53.3343 119.261 53.0576 118.903C52.7842 118.542 52.4196 118.361 51.9639 118.361C51.5179 118.361 51.1582 118.539 50.8848 118.894C50.6113 119.248 50.4746 119.756 50.4746 120.417ZM58.7705 123C58.7184 122.896 58.6761 122.71 58.6436 122.443C58.2236 122.88 57.7223 123.098 57.1396 123.098C56.6188 123.098 56.1908 122.951 55.8555 122.658C55.5234 122.362 55.3574 121.988 55.3574 121.535C55.3574 120.985 55.5658 120.559 55.9824 120.256C56.4023 119.95 56.9915 119.797 57.75 119.797H58.6289V119.382C58.6289 119.066 58.5345 118.815 58.3457 118.63C58.1569 118.441 57.8786 118.347 57.5107 118.347C57.1885 118.347 56.9183 118.428 56.7002 118.591C56.4821 118.754 56.373 118.951 56.373 119.182H55.4648C55.4648 118.918 55.5576 118.664 55.7432 118.42C55.932 118.173 56.1859 117.977 56.5049 117.834C56.8271 117.691 57.1803 117.619 57.5645 117.619C58.1732 117.619 58.6501 117.772 58.9951 118.078C59.3402 118.381 59.5192 118.799 59.5322 119.333V121.765C59.5322 122.25 59.5941 122.635 59.7178 122.922V123H58.7705ZM57.2715 122.312C57.5547 122.312 57.8232 122.238 58.0771 122.092C58.3311 121.945 58.515 121.755 58.6289 121.521V120.437H57.9209C56.8141 120.437 56.2607 120.76 56.2607 121.408C56.2607 121.691 56.3551 121.913 56.5439 122.072C56.7327 122.232 56.9753 122.312 57.2715 122.312ZM60.7285 120.314C60.7285 119.504 60.9206 118.853 61.3047 118.361C61.6888 117.867 62.1917 117.619 62.8135 117.619C63.432 117.619 63.9219 117.831 64.2832 118.254V115.5H65.1865V123H64.3564L64.3125 122.434C63.9512 122.876 63.4482 123.098 62.8037 123.098C62.1917 123.098 61.6921 122.847 61.3047 122.346C60.9206 121.844 60.7285 121.19 60.7285 120.383V120.314ZM61.6318 120.417C61.6318 121.016 61.7555 121.485 62.0029 121.823C62.2503 122.162 62.5921 122.331 63.0283 122.331C63.6012 122.331 64.0195 122.074 64.2832 121.56V119.133C64.013 118.635 63.598 118.386 63.0381 118.386C62.5954 118.386 62.2503 118.557 62.0029 118.898C61.7555 119.24 61.6318 119.746 61.6318 120.417ZM70.8018 121.677L72.0322 117.717H72.999L70.875 123.815C70.5462 124.694 70.0238 125.134 69.3076 125.134L69.1367 125.119L68.7998 125.056V124.323L69.0439 124.343C69.3499 124.343 69.5876 124.281 69.7568 124.157C69.9294 124.034 70.071 123.807 70.1816 123.479L70.3818 122.941L68.4971 117.717H69.4834L70.8018 121.677ZM73.4922 120.31C73.4922 119.792 73.5931 119.326 73.7949 118.913C74 118.5 74.2832 118.181 74.6445 117.956C75.0091 117.731 75.4242 117.619 75.8896 117.619C76.609 117.619 77.1901 117.868 77.6328 118.366C78.0788 118.864 78.3018 119.527 78.3018 120.354V120.417C78.3018 120.931 78.2025 121.394 78.0039 121.804C77.8086 122.211 77.527 122.528 77.1592 122.756C76.7946 122.984 76.3747 123.098 75.8994 123.098C75.1833 123.098 74.6022 122.849 74.1562 122.351C73.7135 121.853 73.4922 121.193 73.4922 120.373V120.31ZM74.4004 120.417C74.4004 121.003 74.5355 121.473 74.8057 121.828C75.0791 122.183 75.4437 122.36 75.8994 122.36C76.3584 122.36 76.723 122.181 76.9932 121.823C77.2633 121.462 77.3984 120.957 77.3984 120.31C77.3984 119.73 77.2601 119.261 76.9834 118.903C76.71 118.542 76.3454 118.361 75.8896 118.361C75.4437 118.361 75.084 118.539 74.8105 118.894C74.5371 119.248 74.4004 119.756 74.4004 120.417ZM82.6963 122.478C82.3447 122.891 81.8288 123.098 81.1484 123.098C80.5853 123.098 80.1556 122.935 79.8594 122.609C79.5664 122.281 79.4183 121.796 79.415 121.154V117.717H80.3184V121.13C80.3184 121.931 80.6439 122.331 81.2949 122.331C81.985 122.331 82.444 122.074 82.6719 121.56V117.717H83.5752V123H82.7158L82.6963 122.478ZM87.5059 118.527C87.3691 118.505 87.221 118.493 87.0615 118.493C86.4691 118.493 86.0671 118.745 85.8555 119.25V123H84.9521V117.717H85.8311L85.8457 118.327C86.1419 117.855 86.5618 117.619 87.1055 117.619C87.2812 117.619 87.4147 117.642 87.5059 117.688V118.527ZM91.124 123V118.415H90.2891V117.717H91.124V117.268C91.124 116.678 91.2917 116.219 91.627 115.891C91.9655 115.562 92.4424 115.397 93.0576 115.397C93.4222 115.397 93.8828 115.497 94.4395 115.695L94.2881 116.457C93.8812 116.294 93.4938 116.213 93.126 116.213C92.7386 116.213 92.4587 116.301 92.2861 116.477C92.1169 116.649 92.0322 116.91 92.0322 117.258V117.717H93.1113V118.415H92.0322V123H91.124ZM94.8887 123H93.9805V117.717H94.8887V123ZM97.3398 123H96.4365V115.5H97.3398V123ZM100.982 123.098C100.266 123.098 99.6836 122.863 99.2344 122.395C98.7852 121.923 98.5605 121.293 98.5605 120.505V120.339C98.5605 119.815 98.6598 119.348 98.8584 118.938C99.0602 118.524 99.3402 118.202 99.6982 117.971C100.06 117.736 100.45 117.619 100.87 117.619C101.557 117.619 102.091 117.845 102.472 118.298C102.853 118.75 103.043 119.398 103.043 120.241V120.617H99.4639C99.4769 121.138 99.6283 121.56 99.918 121.882C100.211 122.201 100.582 122.36 101.031 122.36C101.35 122.36 101.62 122.295 101.842 122.165C102.063 122.035 102.257 121.862 102.423 121.647L102.975 122.077C102.532 122.757 101.868 123.098 100.982 123.098ZM100.87 118.361C100.506 118.361 100.2 118.495 99.9521 118.762C99.7048 119.025 99.5518 119.396 99.4932 119.875H102.14V119.807C102.114 119.348 101.99 118.993 101.769 118.742C101.547 118.488 101.248 118.361 100.87 118.361Z"
                        fill="#0088DA" fill-opacity="0.6"/>
                    <path d="M34.5908 123.977H103.404V124.465H34.5908V123.977Z" fill="#0088DA" fill-opacity="0.6"/>
                </svg>
                <input ref="fileSelect" type='file' style="position: absolute; opacity: 0; z-index: -10;"/>
                <button class="upload-file" @click="uploadFile()">
                    Upload
                </button>
            </div>
            <div v-if="mediaTabId === 3" style="display: flex; flex: 1;flex-direction: column;justify-content: center;">
                <input id="url-link" placeholder="Paste link" type="text" style="border-radius: 32px;border: 1px solid #c4c4c4;padding: 10px;font-size: 12px;color: #7d7777;">
                <button class="upload-file" @click="pasteLink()">
                    Upload
                </button>
            </div>
        </div>
    </div>
</template>

<script>
    export default {
        props: {
            blockId: Number
        },
        name: "uploadmedia",
        components: {

        },
        computed: {},
        mounted() {
            document.querySelector('.media-container').addEventListener('mousewheel', (e) => {
                //e.preventDefault();
                e.stopPropagation();
                //return false;
            });
            document.querySelector('.media-container').addEventListener('DOMMouseScroll', (e) => {
                //e.preventDefault();
                e.stopPropagation();
                //return false;
            });
        },
        methods: {
            gifSearch() {
                let oReq = new XMLHttpRequest();
                let parent = this;
                oReq.onload = function() {
                    parent.giphyList = JSON.parse(this.responseText).data;
                    console.log(parent.giphyList);
                };
                oReq.open("get", `https://api.giphy.com/v1/gifs/search?api_key=qmJnxc55VNJFqzF10IJck8RpxGwcJJns&q=${parent.queryTitle}&limit=40&offset=${parent.giphyOffset}`, true);
                oReq.send();
            },
            openMediaTab(mediaTabId) {
                this.mediaTabId = mediaTabId;
            },
            uploadFile() {
                let parent = this;

                this.$refs.fileSelect.click();
                this.$refs.fileSelect.onchange = function () {
                    if (!this.files && !this.files[0]) return;

                    /*if (this.files && this.files[0]) {
                        let reader = new FileReader();
                        reader.onload = function (e) {
                            console.log(e.target.result);
                        };
                        reader.readAsDataURL(this.files[0]);
                    }*/
                    // let imageFile = document.querySelector('#file');

                    let formData = new FormData();
                    formData.append("image", parent.$refs.fileSelect.files[0]);
                    axios.post('/image-upload', formData, {
                        headers: { 'Content-Type': 'multipart/form-data' }
                    }).then((response) => {
                        console.log(response);
                        parent.$emit('data', parent.blockId, `[img=${response.data.path}]`);
                    }).catch((error) => {
                        console.log(error);
                    });
                };
                /*axios.post(`/client-bot/block/${this.selectedBotId}`, serverBlockModel)
                    .then((response) => {
                        //console.log('saved', response.data);
                    })
                    .catch((error) => {
                        console.log(error);
                    });*/
            },
            pasteYoutubeLink() {
                this.$emit('data', this.blockId, `[youtube=${document.querySelector('#youtube-link').value}]`);
            },
            pasteLink(url) {
                this.$emit('data', this.blockId, `[img=${url || document.querySelector('#url-link').value}]`);
            }
        },
        data() {
            return {
                queryTitle: '',
                giphyOffset: 0,
                giphyList: [],
                mediaTabId: 2
            }
        },
    }
</script>

<style scoped lang="scss">
    .media-container {
        background: #FFFFFF;
        border-radius: 10px;
        padding: 15px;
        align-self: center;
        width: 60%;
        height: 60%;
        display: flex;
        flex-direction: column;

        .upload-file {
            cursor: pointer;
            background: rgb(82, 158, 55);
            color: rgb(255, 255, 255);
            padding: 10px;
            border: 0;
            margin-top: 25px;
            width: 20%;
            align-self: center;
            border-radius: 7px;
        }

        .tab-list {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f4f4f4;
            padding-top: 5px;
            border-radius: 8px;

            div {
                padding: 10px 15px;
                cursor: pointer;
                user-select: none;
                -moz-user-select: none;
                position: relative;
            }

            .selected {
                background: #fff;
                border-radius: 5px 5px 0 0;

                &::before {
                    content: "|";
                    width: 3px;
                    height: 22px;
                    background: #529E37;
                    color: #529E37;
                    position: absolute;
                    left: 7px;
                    top: 8px;
                    border-radius: 6px;
                }
            }
        }
    }
</style>
